/dts-v1/;
#include <st/l4/stm32l431Xb.dtsi>
#include <st/l4/stm32l431c(b-c)ux-pinctrl.dtsi>

/ {
	model = "EllieRF MiniHF";
	compatible = "ellierf,minihf", "st,stm32l431xb";

	chosen {
		zephyr,console = &lpuart1;
		zephyr,shell-uart = &lpuart1;
		zephyr,sram = &sram0;
		zephyr,flash = &flash0;
	};

	leds {
		compatible = "gpio-leds";

		led1: led_1 {
			gpios = <&gpioa 12 GPIO_ACTIVE_HIGH>;
			label = "LED 1";
		};

		led2: led_2 {
			gpios = <&gpioa 11 GPIO_ACTIVE_HIGH>;
			label = "LED 2";
		};

		led3: led_3 {
			gpios = <&gpioa 10 GPIO_ACTIVE_HIGH>;
			label = "LED 3";
		};

		led4: led_4 {
			gpios = <&gpioa 9 GPIO_ACTIVE_HIGH>;
			label = "LED 4";
		};
	};

	pps0: pps {
        compatible = "pps-gpio";
        gpios = <&gpioa 0 GPIO_ACTIVE_HIGH>;
        label = "GPS_PPS";
    };
};

&clk_lse {
    status = "okay";
};

&clk_lsi {
	status = "disabled"; 
};

&clk_hse {
    clock-frequency = <DT_FREQ_M(16)>;
    status = "okay";
};

&clk_hsi {
    status = "disabled"; 
};

&pll {
    div-m = <1>;
    mul-n = <20>;
    div-p = <7>;
    div-q = <2>;
    div-r = <4>;
    clocks = <&clk_hse>;
    status = "okay";
};

&rcc {
	clocks = <&pll>;
	clock-frequency = <DT_FREQ_M(80)>;
	ahb-prescaler = <1>;
	apb1-prescaler = <1>;
	apb2-prescaler = <1>;
};

&lpuart1 {
	pinctrl-0 = <&lpuart1_tx_pb11 &lpuart1_rx_pb10>;
	pinctrl-names = "default";
	current-speed = <115200>;
	status = "okay";
};

&i2c1 {
	pinctrl-0 = <&i2c1_scl_pb6 &i2c1_sda_pb7>;
	pinctrl-names = "default";
	clock-frequency = <I2C_BITRATE_FAST>;
	status = "okay";

	si5351a: si5351a@60 {
		compatible = "silabs,si5351a";
		reg = <0x60>;
		clock-frequency = <25000000>;
		crystal-load-capacitance = <10>;
		status = "okay";
	};

	tps55289: tps55289@75 {
		compatible = "ti,tps55289";
		reg = <0x75>;
		status = "okay";

		ti,external-feedback;
        ti,feedback-resistors-ohms = <274000 100000>;
        ti,rsense-mohm = <0>;

		regulator-name = "V_PA";
        regulator-min-microvolt = <5000000>;
        regulator-max-microvolt = <18000000>;
	};
};

&spi1 {
	pinctrl-0 = <&spi1_nss_pb0 &spi1_sck_pb3
		     &spi1_miso_pb4 &spi1_mosi_pb5>;
	pinctrl-names = "default";
	status = "okay";
};

&rtc {
    clocks = <&rcc STM32_CLOCK(APB1, 28)>,
             <&rcc STM32_SRC_LSE RTC_SEL(1)>;
    status = "okay";
};

&adc1 {
    pinctrl-0 = <&adc1_in11_pa6 &adc1_in12_pa7>;
    pinctrl-names = "default";
    st,adc-clock-source = "SYNC";
    st,adc-prescaler = <4>;
    status = "okay";

    #address-cells = <1>;
    #size-cells = <0>;

    channel@b {
        reg = <11>;
        zephyr,gain = "ADC_GAIN_1";
        zephyr,reference = "ADC_REF_INTERNAL";
        zephyr,acquisition-time = <ADC_ACQ_TIME_DEFAULT>;
        zephyr,resolution = <12>;
    };

    channel@c {
        reg = <12>;
        zephyr,gain = "ADC_GAIN_1";
        zephyr,reference = "ADC_REF_INTERNAL";
        zephyr,acquisition-time = <ADC_ACQ_TIME_DEFAULT>;
        zephyr,resolution = <12>;
    };
};

&dac1 {
    pinctrl-0 = <&dac1_out1_pa4 &dac1_out2_pa5>;
    pinctrl-names = "default";
    status = "okay";
};

&flash0 {
    partitions {
        compatible = "fixed-partitions";
        #address-cells = <1>;
        #size-cells = <1>;

        slot0_partition: partition@0 {
            label = "image-0";
            reg = <0x00000000 DT_SIZE_K(112)>;
        };


        storage_partition: partition@1c000 {
            label = "storage";
            reg = <0x0001c000 DT_SIZE_K(16)>;
        };
    };
};
